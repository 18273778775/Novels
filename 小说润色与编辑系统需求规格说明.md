# 小说润色与编辑系统需求规格说明

## 1. 系统概述

开发一个基于Web的小说润色与编辑系统，专注于帮助作者完善AI生成的小说草稿。系统将通过智能化的文档管理和AI驱动的编辑工具，实现小说内容的高质量优化。该系统将基于用户提供的小说相关文档（包括大纲、人物设定、世界观等）来优化小说内容，去除AI生成痕迹，提升小说质量。

系统支持批量导入章节大纲和角色信息，以及从Markdown文件批量导入小说内容，大幅提高创作效率。通过AI辅助编辑功能，用户可以对小说进行智能润色、内容改写、扩写和章节生成，同时保持角色和情节的一致性。系统还提供完善的版本历史管理和Markdown格式导出功能，为作者提供一站式的小说创作与编辑解决方案。

## 2. 目标用户

使用AI工具生成小说初稿的作者，需要进一步润色、改写或优化内容的用户。

## 3. 核心功能需求

### 3.1 文档管理系统

- **小说项目管理**：
  - 创建、编辑和删除小说项目
  - 项目概览显示（包括字数统计、章节数量、最后编辑时间）
  - 项目分类和标签管理

- **辅助文档管理**：
  - 世界观设定文档：详细描述小说背景、地理、历史、社会结构等
  - 角色设定文档：包含角色姓名、外貌、性格、背景故事、能力、关系网等
  - 故事大纲文档：整体故事线、主要冲突、高潮和结局
  - 自动提取关键信息，用于AI辅助创作的上下文

- **章节管理**：
  - 章节列表视图，显示章节标题、出场角色和内容概要
  - 章节排序和组织功能
  - 章节状态标记（草稿、已润色、已完成等）
  - 章节间关系管理，确保情节连贯性

### 3.2 批量导入功能

#### 3.2.1 章节大纲批量导入
- **支持格式**：
  - 纯文本格式（每行一个章节，标题和概述用特定分隔符分开）
- **格式规范**：
  ```
  第一章:圣剑的秘密|主角在古老遗迹中发现传说中的圣剑，引发一系列神秘事件。
  第二章:黑暗势力|邪恶组织追踪圣剑下落，主角被迫踏上逃亡之路。
  ```
- **导入界面**：
  - 文本粘贴区域
  - 格式预览和验证

#### 3.2.2 角色信息批量导入
- **支持格式**：
  - 纯文本格式（每个角色信息块之间有明确分隔）
- **格式规范**：
  ```
  角色名:李剑|性格:正直勇敢，不畏强权|外貌:身材高大，面容坚毅，眼神锐利|背景:出身武林世家，父母被仇家所害，自小立志复仇
  角色名:林月|性格:聪明机智，善良温柔|外貌:长发及腰，明眸皓齿，气质出尘|背景:隐世门派掌门之女，精通医术和轻功
  ```
- **导入选项**：
  - 文本粘贴区域
  - 格式验证和预览

### 3.3 AI辅助编辑功能

- **智能润色功能**：
  - 基于项目文档（世界观、角色设定、大纲）进行上下文感知的润色
  - 去除AI生成痕迹，提升文字表达和流畅度
  - 多种文风选择（优雅文学、通俗易懂等）

- **内容改写功能**：
  - 根据用户指令和上下文，调整叙事风格、情节走向或人物描写
  - 保持角色语言风格和行为一致性
  - 考虑前后章节内容，确保情节连贯

- **内容扩写功能**：
  - 基于章节概述和相关角色信息，丰富细节描写
  - 智能扩展对话、心理描写和环境描写
  - 控制扩写字数和方向（向前/向后扩展）

- **章节生成功能**：
  - 根据章节大纲自动生成完整章节内容
  - 融合世界观和角色设定，确保内容一致性
  - 考虑上下章节内容，保持情节连贯性

### 3.4 写作风格管理

- **写作风格提示词**：
  - 在系统设置中添加写作风格提示词编辑区域
  - 用户可自定义提示词，指导AI生成符合特定风格的内容
  - 提示词将作为AI创作的上下文，确保风格一致性
  - 支持预设风格模板（古典文学、现代都市、科幻奇幻等）
  - 风格选择器组件，便于快速切换不同写作风格

### 3.5 编辑器功能

- **富文本编辑器**：
  - 支持文本格式化（加粗、斜体、下划线等）
  - 实时字数统计和自动保存
  - 段落缩进和排版优化（适合中文小说）

- **版本历史**：
  - 记录编辑历史，支持版本比较和回滚
  - 显示AI辅助编辑的修改记录
  - 编辑历史时间线视图

### 3.6 导出功能

- **Markdown格式导出**：
  - 支持将小说内容导出为Markdown(.md)格式
  - 导出时保留基本格式和结构
  - 支持完整项目导出或章节选择性导出
  - 导出内容可包含章节内容、角色设定和世界观等辅助文档

### 3.7 小说内容批量导入

- **Markdown格式批量导入**：
  - 支持从Markdown文件批量导入小说章节内容
  - 自动识别章节标题格式（如"第一章 铁匠铺的少年"）并提取对应内容
  - 自动将章节编号标准化（如"第一章"转换为"第1章"）
  - 支持多种章节标题格式识别（中文数字、阿拉伯数字等）
  
- **批量文件处理**：
  - 支持导入单个包含多章节的Markdown文件
  - 支持导入多个Markdown文件（如1-10.md, 11-20.md等）
  - 自动合并和排序章节，避免重复或错乱
  
- **导入界面**：
  - 文件上传区域
  - 章节预览和确认界面
  - 导入进度显示
  - 导入结果报告（成功导入章节数、失败章节等）
  
- **导入后处理**：
  - 导入后自动更新项目总字数和章节数
  - 支持导入后的章节编辑和调整
  - 保留原始Markdown格式的关键元素（如加粗、斜体等）

## 4. 用户界面设计

- **整体风格**：
  - 主色调：#2F54EB（专业蓝色）
  - 辅助色：#722ED1（优雅紫色）
  - 背景色：#FAFAFA（暖白色）
  - 文本色：#262626（可读黑色）
  - 强调色：#52C41A（成功绿色）
  - 警告色：#FA8C16（编辑橙色）

- **布局设计**：
  - 左侧导航栏：项目列表、文档管理、设置等
  - 中央区域：
    - 项目管理视图：项目卡片、创建项目按钮
    - 文档管理视图：文档列表、文档编辑器
    - 章节管理视图：章节列表、章节状态指示
    - 编辑视图：富文本编辑器，章节内容展示
  - 右侧辅助区：
    - AI工具面板：润色、改写、扩写、生成功能
    - 章节信息面板：标题、概要、出场角色
    - 编辑历史面板：版本记录、比较功能
  - 顶部工具栏：
    - 导入/导出功能
    - 批量操作功能
    - 用户设置
  - 模态对话框：
    - 批量导入界面
    - 文档创建/编辑界面
    - 设置界面
  - 响应式设计，适配不同屏幕尺寸

- **字体与排版**：
  - 主要字体：PingFang SC/Microsoft YaHei/Inter
  - 编辑区行高：1.8（优化中文阅读体验）
  - 段落首行缩进：2em（符合中文排版习惯）
  - 统一间距：20px

- **批量导入界面**：
  - 拖放文件上传区域
  - 文件列表显示（支持多选）
  - 导入预览界面，显示识别到的章节结构
  - 导入选项配置（如章节编号格式化选项）
  - 导入进度指示器和结果摘要

## 5. 技术实现要点

### 5.1 前端技术
- **核心框架**：React + TypeScript
- **组件库**：shadcn/ui（基于Radix UI和Tailwind CSS）
- **富文本编辑器**：TipTap（基于ProseMirror）
- **样式管理**：Tailwind CSS + CSS变量实现主题定制
- **状态管理**：React Query（服务端状态）+ Zustand（客户端状态）
- **Markdown解析**：remark/rehype生态系统，用于批量导入/导出功能
- **设计系统**：组件分层架构（基础组件、复合组件、页面组件）

### 5.2 后端技术
- **核心框架**：Node.js + Nest.js
- **API设计**：RESTful API + WebSocket（实时协作）
- **身份验证**：JWT + OAuth2.0
- **文件处理**：Multer（文件上传）+ Sharp（图像处理）
- **AI服务集成**：多模型抽象层，支持以下模型：
  - DeepSeek API
  - 豆包API
  - 通义千问API
  - 可扩展支持其他模型

### 5.3 数据库技术
- **主数据库**：MongoDB（文档型数据库）
  - 适合存储非结构化的小说内容和设定文档
  - 支持灵活的schema，适应不同类型的文档
- **缓存层**：Redis
  - 提高频繁访问数据的响应速度
  - 支持分布式锁，解决协作编辑的并发问题
  - 存储用户会话和临时编辑状态

### 5.4 AI模型集成架构
- **模型抽象层**：统一接口设计，支持多种AI服务无缝切换
- **API密钥与端点**：
  - DeepSeek API：sk-64f2396064214545a04cb81ed9dc0380
  - Google Gemini API：AIzaSyDu4x0bcq1JjEuEcLQkri-A-KOlACv1Rb4
  - 火山引擎API：2836e8fe-8f55-4eb9-9b68-bfca206e678e (api-key-20250530231834)
  - 支持环境变量配置，避免硬编码
  - 提供API配置管理界面，支持动态更新
- **模型选择策略**：
  - 豆包1.5-Pro：作为主力模型（80%任务），处理章节生成、内容润色和对话生成
  - 豆包1.5-Lite：处理批量导入等低复杂度任务，成本极低
  - DeepSeek R1：处理复杂推理任务（20%高难度任务）
  - 通义千问：作为应急备选，提供稳定性保障
- **任务分配机制**：
  - 章节生成：Doubao-1.5-Pro（质量好且成本适中）
  - 内容润色：Doubao-1.5-Pro（中文优化能力强）
  - 批量导入处理：Doubao-1.5-Lite（成本极低）
  - 对话生成：Doubao-1.5-Pro（对话自然度高）
  - 复杂推理：DeepSeek R1（必要时使用）
- **上下文管理**：智能提取和组织小说相关文档，作为AI生成的上下文
- **缓存机制**：实现结果缓存，减少重复API调用
- **失败重试**：在模型调用失败时自动切换到备选模型
- **API配置管理**：
  - 环境变量管理API密钥，避免硬编码
  - 支持在管理界面中更新API配置
  - 实现API调用限流和监控

### 5.5 数据模型
- **用户表**：
  - 用户ID、用户名、密码哈希、邮箱、注册日期、上次登录时间、偏好设置

- **小说项目表**：
  - 项目ID、用户ID、标题、描述、封面图片、总字数、总章节数、状态、创建日期、更新日期、默认AI设置

- **章节表**：
  - 章节ID、项目ID、章节序号、标题、内容、概要、出场角色、字数、状态、创建日期、更新日期、最后编辑者ID

- **文档表**：
  - 文档ID、项目ID、类型（世界观、角色、大纲、设定）、标题、内容、元数据、创建日期、更新日期

- **角色表**：
  - 角色ID、项目ID、姓名、描述、外貌、性格、背景、能力、关系、头像、是否主角、创建日期、更新日期

- **编辑历史表**：
  - 历史ID、章节ID、旧内容、新内容、编辑类型、AI模型、AI提示、编辑者ID、编辑时间、差异摘要

- **导入记录表**：
  - 记录ID、项目ID、导入类型（章节大纲、角色信息、小说内容）、文件名、导入状态、成功章节数、失败章节数、导入时间、导入者ID

- **AI设置表**：
  - 设置ID、用户ID（可选）、项目ID（可选）、提供商、模型名称、温度、最大令牌数、自定义提示词、创建日期、更新日期

- **协作表**：
  - 协作ID、章节ID、用户ID、锁定状态、锁定时间、评论内容、变更类型、创建时间

- **分析结果表**：
  - 分析ID、项目ID、分析类型（情节连贯性、人物一致性）、分析结果、建议内容、分析时间

### 5.6 部署架构
- **容器化**：Docker + Docker Compose
- **CI/CD**：GitHub Actions
- **监控**：Prometheus + Grafana
- **日志管理**：ELK Stack（Elasticsearch, Logstash, Kibana）

## 6. 系统流程

1. 用户创建小说项目
2. 上传/创建世界观、角色设定和故事大纲（支持批量导入）
3. 创建章节结构和章节概述（支持批量导入）
4. **批量导入小说内容（可选）**
   - 上传Markdown文件
   - 系统自动识别章节结构
   - 预览和确认导入内容
   - 完成导入并自动更新项目信息
5. 系统自动提取关键信息作为AI上下文
6. 用户选择章节进行编辑
7. 使用AI辅助工具（润色/改写/扩写/生成）
8. 系统考虑相关文档和上下章节内容进行处理
9. 用户审阅和手动调整内容
10. 保存更新并记录编辑历史
11. 导出完整小说或选定章节

## 7. 补充功能

### 7.1 智能分析与建议
- **情节连贯性分析**：
  - 检测前后章节的情节冲突
  - 识别人物行为不一致问题
  - 提供修正建议

### 7.2 协作功能
- **多人协作编辑**：
  - 章节锁定机制
  - 变更追踪和合并
  - 评论和反馈系统

### 7.3 创作辅助工具
- **名称生成器**：
  - 根据世界观生成符合设定的人名、地名
- **情节灵感生成**：
  - 基于现有内容提供情节发展建议
- **对话生成器**：
  - 根据角色性格生成符合特征的对话

### 7.4 本地化与备份
- **离线编辑模式**：
  - 支持无网络环境下的基础编辑
- **自动备份策略**：
  - 定时备份到云端
  - 本地备份选项

## 8. 用户体验优化

### 8.1 个性化界面
- **自定义工作区布局**：
  - 可拖拽面板
  - 显示/隐藏功能区
  - 暗色/亮色主题切换

### 8.2 引导与教程
- **交互式新手引导**：
  - 功能介绍步骤
  - 视频教程
  - 示例项目

## 9. 未来扩展计划

- 集成更多AI模型选择
- 添加更多导入格式支持（CSV/Excel、Markdown、JSON）
- 开发移动端应用
- 添加数据分析功能（创作统计、使用情况分析）
- 社区功能（作品分享、读者反馈）

---

本需求规格说明书提供了一个全面的小说润色与编辑系统框架，强调了上下文感知的AI辅助编辑功能，确保系统能够理解并应用小说的世界观、角色设定和章节关系，从而提供高质量的内容优化服务。系统设计注重用户体验和工作流程优化，为小说创作者提供一个高效、智能的创作平台。












